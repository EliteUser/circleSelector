!function(){"use strict";const t=t=>{const e=t.getBoundingClientRect();return{x:e.x,y:e.y,width:e.width,height:e.height}},e=e=>{const s=t(e);return{x:s.x+s.width/2,y:s.y+s.height/2}},s={fullCircle:!1,counterStart:1,counterEnd:10,counterStep:1,counterValues:[],sectorWidth:20,rotationStep:12,edgeAngle:36,gapAngle:36,transitionDuration:300,progressBar:!0,progressBarWidth:16,progressColor:"#dde3f0",circleColor:"#131313",circleBorderColor:"#dde3f0",valueBackgroundColor:"transparent",valueColor:"#dde3f0"};const i=document.querySelector(".circle-selector"),n=new class{constructor(e,i={}){this.settings=Object.assign({},s,i),this.container=e,this.containerWidth=t(this.container).width,this.circleRadius=this.containerWidth-this.containerWidth*this.settings.sectorWidth/100,e.setAttribute("tabindex",0),this.settings.fullCircle&&(this.circleRadius=this.containerWidth-this.containerWidth*this.settings.sectorWidth/100*2,this.container.style.borderRadius="50%"),this.zeroRotation=-this.settings.rotationStep/2,this.currentProgress=0,this.containerElements=this._createCircle(),this.input=this.containerElements.querySelector(".circle-selector__input"),this.circle=this.containerElements.querySelector(".circle-selector__circle"),this.circleElements=this.containerElements.querySelectorAll(".circle-selector__element"),this.settings.fullCircle||(this.circle.style.borderLeftStyle="none"),this._clickHandler=this._clickHandler.bind(this)}_onValueChange(){const t=this._getSelectedElement().querySelector(".circle-selector__value").textContent;this.input.value!==t&&(this.input.value=t,this.input.dispatchEvent(new Event("change")))}_setProperties(){const t=document.documentElement.style,e=this.settings.fullCircle?"50%":"0",s=this.settings.fullCircle?"50%":"100%";t.setProperty("--sector-width",this.settings.sectorWidth+"%"),t.setProperty("--element-left",e),t.setProperty("--element-width",s),t.setProperty("--circle-color",this.settings.circleColor),t.setProperty("--circle-border-color",this.settings.circleBorderColor),t.setProperty("--value-background-color",this.settings.valueBackgroundColor),t.setProperty("--value-color",this.settings.valueColor)}render(){this.container.appendChild(this.containerElements),this._setProperties(),this._attachFocusHandler(),this._rotateElementsTo(this.circleElements[0],this.zeroRotation);for(const t of this.circleElements)this._attachMouseHandlers(t),this._attachTouchHandlers(t)}_createCircle(){const t=this.settings.fullCircle?"border-radius: 50%; padding: 50%;":"",e=this.settings.fullCircle?"padding-left: var(--sector-width)":"padding-left: 0;",s=this.container.dataset.id?this.container.dataset.id:"circle-selector";let i=[];if(this.settings.counterValues.length)i=[...this.settings.counterValues];else for(let t=this.settings.counterStart;t<=this.settings.counterEnd;t+=this.settings.counterStep)i.push(t);return(t=>{const e=document.createElement("div");return e.innerHTML=t.trim(),e.children[0]})(`\n      <div class="circle-selector__container" style="${e}">\n        <input type="text" class="circle-selector__input visually-hidden" id="${s}">\n        \n        <div class="circle-selector__circle progress" style="${t}">\n          ${this.settings.progressBar?`<div class="progress__container${this.settings.fullCircle?"progress__container--full-circle":""}">\n              <canvas width="1000px" height="1000px" class="progress__bar"></canvas>  \n            </div>`:""}\n          </div>        \n        <div class="circle-selector__elements">${i.map((t,e)=>this._createCircleElementMarkup(t,e)).join("")}\n        </div>\n      </div>`)}_createCircleElementMarkup(t,e){const s=this.settings.rotationStep;var i;return`\n      <div class="circle-selector__element" style="transform: rotate(${e*s+this.zeroRotation}deg)" data-rotation="${e*s}" data-id="${t}">\n        <div class="circle-selector__wrapper">\n          <div class="circle-selector__value" style="${`\n      left: ${this.settings.fullCircle?100-this.settings.sectorWidth+"%":100-this.settings.sectorWidth/2+"%"};\n      bottom: ${100*(this.containerWidth-this.circleRadius*(i=s,Math.sin(i*Math.PI/180)))/(2*this.containerWidth)+"%"};\n      transform: rotate(${-this.zeroRotation}deg);\n    `}">${t}</div>\n        </div>\n      </div>  \n    `}_updateProgressBar(){const t=this.currentProgress,e=this.settings.fullCircle?360:180,s=parseFloat(this.circleElements[0].dataset.rotation);this.currentProgress=e/((this.circleElements.length-1)*this.settings.rotationStep)*-s;const i=e=>{const s=document.querySelector(".progress__bar").getContext("2d"),i=t+(this.currentProgress-t)*e;s.lineWidth=this.settings.progressBarWidth,s.clearRect(0,0,1e3,1e3),s.strokeStyle=this.settings.progressColor,s.beginPath(),s.arc(500,500,500-this.settings.progressBarWidth/2,-90*Math.PI/180,(-90+i)*Math.PI/180),s.stroke()};t!==this.currentProgress&&((t,e)=>{const s=performance.now();requestAnimationFrame((function i(n){let r=(n-s)/e;r>1?r=1:r<0&&(r=0),t(r),r<1&&requestAnimationFrame(i)}))})(i,this.settings.transitionDuration)}_getVisibility(t){const{edgeAngle:e,gapAngle:s}=this.settings,i=t-this.zeroRotation;return i>e+s||i<-(e+s)?"none":i>e?1-(i-e)/s:i<-e?1+(i+e)/s:1}_getRotationAngle(t){let e=180*Math.atan(t.y/t.x)/Math.PI;return t.x<0&&t.y>0?e+=180:t.x<0&&t.y<0&&(e-=180),e}_applyTransition(t){this._isTransitioned=t,this.circleElements.forEach(e=>{if("none"!==e.style.display){const s=e.querySelector(".circle-selector__wrapper");t?(e.style.transitionProperty="transform, opacity",e.style.transitionDuration=this.settings.transitionDuration+"ms",e.style.transitionTimingFunction="ease-out",s.style.transition=`transform ${this.settings.transitionDuration}ms ease-out`):(e.style.transitionProperty="none",e.style.transitionDuration="none",e.style.transitionTimingFunction="none",s.style.transition="none")}})}_getSelectedElement(){return[...this.circleElements].find(t=>{const e=parseFloat(t.dataset.rotation);return e<=this.settings.rotationStep/2&&e>=-this.settings.rotationStep/2})}_completeRotation(){const t=this._getSelectedElement();this._rotateElementsTo(t,this.zeroRotation)}_rotateElementsTo(t,e){const s=[...this.circleElements].findIndex(e=>e===t),i=[...this.circleElements].map((t,i)=>e-(s-i)*this.settings.rotationStep);i[0]>this.zeroRotation||i[i.length-1]<this.zeroRotation||(this.circleElements.forEach((t,e)=>{let s=i[e];const n=this._getVisibility(s),r=t.querySelector(".circle-selector__wrapper");t.style.transform=`rotate(${s}deg) skew(${90-this.settings.rotationStep}deg)`,t.dataset.rotation=""+(s-this.zeroRotation),r.style.transform=`skew(${-(90-this.settings.rotationStep)}deg)`,"none"===n?(t.style.opacity="0",t.style.pointerEvents="none",t.style.zIndex="-100"):(t.style.opacity=n,t.style.pointerEvents="initial",t.style.zIndex="0")}),this._onValueChange(),this.settings.progressBar&&this._updateProgressBar())}_selectElement(t="next"){const e=this._getSelectedElement(),s=[...this.circleElements].findIndex(t=>t===e);let i=0;switch(t){case"next":if(s+1>this.circleElements.length-1)return;i=s+1;break;case"prev":if(s-1<0)return;i=s-1;break;default:return}const n=[...this.circleElements][i];this._rotateElementsTo(n,this.zeroRotation)}_clickHandler(t){t.preventDefault();const e=t.target;this._rotateElementsTo(e.closest(".circle-selector__element"),this.zeroRotation)}_attachMouseHandlers(t){const s=t.querySelector(".circle-selector__wrapper");s.addEventListener("click",this._clickHandler),s.addEventListener("mousedown",i=>{i.preventDefault(),this._applyTransition(!1);const n=e(this.circle);let r={x:i.clientX-n.x,y:i.clientY-n.y},o=this._getRotationAngle(r);const c=e=>{e.preventDefault(),s.removeEventListener("click",this._clickHandler);const i=parseFloat(t.dataset.rotation)+this.zeroRotation,c={x:e.clientX-n.x,y:e.clientY-n.y},l=i-(o-this._getRotationAngle(c));r={x:e.clientX-n.x,y:e.clientY-n.y},o=this._getRotationAngle(r),requestAnimationFrame(()=>{this._rotateElementsTo(t,l)})},l=t=>{t.preventDefault(),this._applyTransition(!0),this._completeRotation(),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",l)};s.addEventListener("click",this._clickHandler),document.addEventListener("mousemove",c),document.addEventListener("mouseup",l)})}_attachTouchHandlers(t){const s=t.querySelector(".circle-selector__wrapper");s.addEventListener("touchstart",i=>{this._clicked=!0,this._applyTransition(!1);const n=e(this.circle);let r={x:i.targetTouches[0].clientX-n.x,y:i.targetTouches[0].clientY-n.y},o=this._getRotationAngle(r);const c=e=>{e.preventDefault(),this._clicked=!1;const s=parseFloat(t.dataset.rotation)+this.zeroRotation,i={x:e.targetTouches[0].clientX-n.x,y:e.targetTouches[0].clientY-n.y},c=s-(o-this._getRotationAngle(i));r={x:e.targetTouches[0].clientX-n.x,y:e.targetTouches[0].clientY-n.y},o=this._getRotationAngle(r),requestAnimationFrame(()=>{this._rotateElementsTo(t,c)})},l=t=>{this._clicked&&this._clickHandler(t),this._applyTransition(!0),this._completeRotation(),s.removeEventListener("touchmove",c),s.removeEventListener("touchend",l)};s.addEventListener("touchmove",c),s.addEventListener("touchend",l)})}_attachFocusHandler(){const t=t=>{const e=t.key;this._isTransitioned||this._applyTransition(!0),"ArrowUp"===e?this._selectElement("prev"):"ArrowDown"===e&&this._selectElement("next")};this.container.addEventListener("focus",()=>{document.addEventListener("keydown",t)}),this.container.addEventListener("blur",()=>{document.removeEventListener("keydown",t)})}}(i,{fullCircle:!1});n.render(),n.input.addEventListener("change",t=>{document.querySelector(".res").innerText=t.target.value})}();
